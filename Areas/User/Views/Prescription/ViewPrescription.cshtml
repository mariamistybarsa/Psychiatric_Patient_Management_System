@model IEnumerable<Psychiatrist_Management_System.Models.PrescriptionVM>

<div class="container">

    <h2>Psychiatrist Prescription</h2>

    @if (Model.Any())
    {
        var first = Model.First();

        <!-- Doctor Info -->
        <div class="section">
            <center><h2>Doctor Information</h2></center>
            <p><label>Full Name:</label> @first.PsychiatristName <span class="underline"></span></p>
            <p><label>Qualification:</label> @first.PsychiatristName  <span class="underline"></span></p>
            <p><label>Booking Serial No.:</label> @first.BookingSerial <span class="underline"></span></p>
            <p><label>Contact:</label> @first.Age<span class="underline"></span></p>
        </div>

        <!-- Patient Info -->
        <div class="section">
            <h3>Patient Information</h3>
            <p><label>Name:</label> @first.PatientName <span class="underline"></span></p>
            <p><label>Address / Contact:</label> <span class="underline"></span></p>
            <div class="row">
                <div><label>Age:</label> @first.Age <span class="underline"></span></div>
                <div><label>Sex:</label> <span class="underline"></span></div>
                
                <div><label>Identity Marks:</label> @first.Diagnosed <span class="underline"></span></div>
            </div>
        </div>

        <!-- Prescription Table -->
        <div class="section">
            <h3>Prescription Details</h3>
            <table>
                <thead>
                    <tr>
                        <th>Sr.</th>
                      
                        <th>Medicine</th>
                        <th>Notes</th>
                        <th>Dose</th>
                        <th>Duration</th>
                        <th>Frequency</th>
                        <th>Medical Advice</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int sr = 1;
                    }
                    @foreach (var med in Model)
                    {
                        <tr>
                            <td>@sr</td>
                            
                            <td>@med.MedicineName</td>
                            <td>@med.Medicine_Notes</td>
                            <td>@med.MedicineDose</td>
                            <td>@med.MedicineDuration</td>
                            <td>@med.Frequency</td>
                            <td>@med.Advice</td>
                        </tr>
                        sr++;
                    }
                </tbody>
            </table>
        </div>

        <!-- Advice Section -->
        <div class="section advice">
            <h3>Advice / Diet Instructions</h3>
            <p><span class="underline">@first.Advice</span></p>
        </div>

        <!-- Signatures -->
        <div class="section signature">
            <div>Doctor’s Signature</div>
            <div>Authentication</div>
        </div>

        <div class="text-center" style="margin-top:20px;">
            <button id="printBtn" style="padding:10px 20px; font-size:16px; cursor:pointer;">Print / Download PDF</button>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
        <script>
            document.getElementById("printBtn").addEventListener("click", function () {
                const element = document.querySelector(".container");
                var opt = {
                    margin:       0.5,
                    filename:     'Prescription.pdf',
                    image:        { type: 'jpeg', quality: 0.98 },
                    html2canvas:  { scale: 2 },
                    jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
                };
                html2pdf().set(opt).from(element).save();
            });
        </script>

    }
    else
    {
        <p class="text-danger">No prescription data found.</p>
    }

</div>

<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background: #f3f3f3;
        color: #000;
        line-height: 1.3; /* line spacing komano */
    }

    .container {
        max-width: 800px;
        margin: 20px auto;
        background: #fff;
        padding: 25px 30px; /* padding slightly komano */
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    h2 {
        text-align: center;
        text-decoration: underline;
        margin-bottom: 20px; /* margin komano */
        font-size: 24px;
        font-weight: 600;
        line-height: 1.2;
    }

    h3 {
        margin-top: 20px;
        margin-bottom: 8px; /* komano */
        font-size: 15px;
        color: #333;
        line-height: 1.2;
    }

    .section {
        margin-bottom: 18px; /* komano */
    }

    .row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px; /* komano */
    }

        .row div {
            flex: 1 1 48%;
        }

    label {
        font-weight: 600;
        display: inline-block;
        width: 120px;
        margin-bottom: 3px; /* label er niche kom spacing */
    }

    .underline {
        border-bottom: 1px solid #000;
        display: inline-block;
        width: calc(100% - 130px);
        min-height: 18px; /* slightly komano */
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 13px; /* slightly komano */
        table-layout: fixed;
        word-wrap: break-word;
    }

    th, td {
        padding: 6px 6px; /* komano */
        text-align: left;
        vertical-align: top;
        min-height: 40px; /* komano */
    }

    th {
        background-color: #f0f0f0;
        text-align: center;
    }

    .signature {
        margin-top: 25px; /* komano */
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }

        .signature div {
            width: 48%;
            text-align: center;
            font-weight: 600;
            border-top: 1px solid #000;
            padding-top: 6px; /* komano */
        }

    .advice span.underline {
        min-height: 40px;
        width: 100%;
        display: block;
    }

    button {
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        padding: 8px 18px;
        font-size: 15px;
    }

        button:hover {
            background-color: #0056b3;
        }

</style>
