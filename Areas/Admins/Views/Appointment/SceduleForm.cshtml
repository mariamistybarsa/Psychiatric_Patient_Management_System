<div class="container mt-5">
    <div class="text-center mb-4">
        <h2 class="fw-bold">Book Psychiatrist Appointment</h2>
        <p class="text-muted">Select a psychiatrist and add available schedule</p>
    </div>

    <!-- Select Psychiatrist -->
    <div class="mb-4">
        <label for="psychiatristSelect" class="form-label fw-semibold">Select Psychiatrist</label>
        <select class="form-select form-select-lg" id="psychiatristSelect">
            <option selected disabled>Choose psychiatrist</option>
            @foreach (var psy in ViewBag.Psychiatrists)
            {
                <option value="@psy.UserId">@psy.UserName</option>
            }
        </select>
    </div>

    <!-- Psychiatrist Details Section -->
    <div id="psychiatristDetails" class="card shadow-sm p-4 mt-3" style="display:none;">
        <div class="card-header bg-primary text-white fw-bold">Psychiatrist Details</div>
        <div class="card-body">
            <p id="psyName" class="mb-2"><strong>Name:</strong></p>
            <p id="psySpecialty" class="mb-4"><strong>Specialty:</strong></p>

            <!-- Day & Time Form -->
            <form id="scheduleForm" class="row g-3 mb-4">
                <div class="col-md-4">
                    <label for="daySelect" class="form-label">Select Day</label>
                    <select class="form-select" id="daySelect">
                        <option selected disabled>Choose day</option>
                        <option>Monday</option>
                        <option>Tuesday</option>
                        <option>Wednesday</option>
                        <option>Thursday</option>
                        <option>Friday</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="startTime" class="form-label">Start Time</label>
                    <input type="time" class="form-control" id="startTime">
                </div>
                <div class="col-md-3">
                    <label for="endTime" class="form-label">End Time</label>
                    <input type="time" class="form-control" id="endTime">
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="button" class="btn btn-success w-100" id="addBtn">Add</button>
                </div>
            </form>

            <!-- Schedule List -->
            <h5 class="fw-semibold mb-3">Added Schedule</h5>
            <div class="table-responsive">
                <table class="table table-hover table-bordered align-middle text-center">
                    <thead class="table-light">
                        <tr>
                            <th>Day</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTableBody">
                        <!-- Dynamic rows will appear here -->
                    </tbody>
                </table>
            </div>

            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-primary" id="saveBtn">Save All</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Create a JavaScript object from the backend data
    const psychiatrists = {
        @foreach (var psy in ViewBag.Psychiatrists)
        {
                <text>
                @psy.UserId: { name: "@psy.UserName", specialty: "@psy.Specialty" },
                </text>
        }
    };

    const select = document.getElementById('psychiatristSelect');
    const detailsDiv = document.getElementById('psychiatristDetails');
    const nameP = document.getElementById('psyName');
    const specialtyP = document.getElementById('psySpecialty');
    const addBtn = document.getElementById('addBtn');
    const saveBtn = document.getElementById('saveBtn');
    const tableBody = document.getElementById('scheduleTableBody');

    let scheduleList = [];

    select.addEventListener('change', function() {
        const selected = psychiatrists[this.value];
        if(selected){
            nameP.textContent = "Name: " + selected.name;
            specialtyP.textContent = "Specialty: " + selected.specialty;
            detailsDiv.style.display = "block";
            scheduleList = [];
            tableBody.innerHTML = '';
        }
    });

    addBtn.addEventListener('click', function() {
        const day = document.getElementById('daySelect').value;
        const start = document.getElementById('startTime').value;
        const end = document.getElementById('endTime').value;

        if(day && start && end){
            const scheduleItem = { day, start, end };
            scheduleList.push(scheduleItem);

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${day}</td>
                <td>${start}</td>
                <td>${end}</td>
                <td><button class="btn btn-sm btn-danger deleteBtn">Delete</button></td>
            `;
            tableBody.appendChild(row);

            row.querySelector('.deleteBtn').addEventListener('click', function() {
                const index = Array.from(tableBody.children).indexOf(row);
                scheduleList.splice(index, 1);
                row.remove();
            });

            document.getElementById('daySelect').value = '';
            document.getElementById('startTime').value = '';
            document.getElementById('endTime').value = '';
        } else {
            alert("Please fill all fields!");
        }
    });

    saveBtn.addEventListener('click', function() {
        if(scheduleList.length === 0){
            alert("No schedule to save!");
            return;
        }
        console.log("Schedule to save:", scheduleList);
        alert("Schedule saved successfully!");




        // Here you can send scheduleList to your server using fetch/ajax
    });
</script>

