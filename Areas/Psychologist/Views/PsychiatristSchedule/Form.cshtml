@model Psychiatrist_Management_System.Models.PsychiatristSchedule
@{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h2>Psychiatrist Schedule</h2>

<form id="scheduleForm">
    <!-- Hidden PsychiatristId, e.g., from logged-in user or controller -->
    @* <input type="hidden" id="PsychiatristId" value="@Model.PsychiatristId" /> *@

    <div class="form-group">
        <label asp-for="StartDay">Start Day</label>
        <select asp-for="StartDay" class="form-control" id="StartDay">
            <option value="">-- Select Day --</option>
            <option value="Saturday">Saturday</option>
            <option value="Sunday">Sunday</option>
            <option value="Monday">Monday</option>
            <option value="Tuesday">Tuesday</option>
            <option value="Wednesday">Wednesday</option>
            <option value="Thursday">Thursday</option>
            <option value="Friday">Friday</option>
        </select>
    </div>

    <div class="form-group">
        <label asp-for="EndDay">End Day</label>
        <select asp-for="EndDay" class="form-control" id="EndDay">
            <option value="">-- Select Day --</option>
            <option value="Saturday">Saturday</option>
            <option value="Sunday">Sunday</option>
            <option value="Monday">Monday</option>
            <option value="Tuesday">Tuesday</option>
            <option value="Wednesday">Wednesday</option>
            <option value="Thursday">Thursday</option>
            <option value="Friday">Friday</option>
        </select>
    </div>


    <div class="form-group">
        <label asp-for="StartTime"></label>
        <input asp-for="StartTime" class="form-control" type="text" id="StartTime" placeholder="Start Time" />
    </div>

    <div class="form-group">
        <label asp-for="EndTime"></label>
        <input asp-for="EndTime" class="form-control" type="text" id="EndTime" placeholder="End Time" />
    </div>

    <div class="form-group">
        <label asp-for="Status"></label>
        <select asp-for="Status" class="form-control" id="Status">
            <option value="">-- Select Status --</option>
            <option value="Available">Available</option>
            <option value="Unavailable">Unavailable</option>
        </select>
    </div>

    <button type="button" id="submitSchedule" class="btn btn-primary">Save</button>
</form>

<div id="resultMessage" class="mt-3"></div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#submitSchedule').click(function (e) {
                e.preventDefault();
                debugger;

                const startDay = $('#StartDay').val()
                const endDay = $('#EndDay').val()
                const startTime = $('#StartTime').val()
                const endTime = $('#EndTime').val()
                const status = $('#Status').val().trim();

                // Validation
                if ( !StartDay ||!EndDay ||  !startTime || !endTime || !status) {
                    $('#resultMessage').text('Please fill out all fields.').css('color', 'red');
                    return;
                }

                const model = {
                    PsychiatristId: 0,
                   StartDay: startDay,
                   EndDay:endDay,
                    StartTime: startTime,
                    EndTime: endTime,
                    Status: status
                };
    


                $.ajax({
                     url: '/Psychologist/PsychiatristSchedule/Save', 
            type: 'POST',
            data: model,
                    success: function(response) {
                        if (response.success) {
                            $('#resultMessage').text('Schedule saved successfully!').css('color', 'green');
                            $('#scheduleForm')[0].reset();



                              setTimeout(function () {
                           window.location.href = '/Psychologist/PsychiatristSchedule/Index';
                        }, 2000);
                        } else {
                            $('#resultMessage').text('Error: ' + response.message).css('color', 'red');
                        }
                    },
                    error: function(xhr) {
                        $('#resultMessage').text('Error: ' + (xhr.responseText || 'Unknown error')).css('color', 'red');
                    }
                });
            });
        });
              
    </script>
}
